<div class="p-md" ng-controller="CategoryAuditingController">
	<div class="panel panel-default">
		<table class="table">
			<thead>
				<tr>
					<td colspan="7">工作流</td>
				</tr>
				<tr><th>#</th><th></th><th></th><th></th><th></th><th></th><th></th></tr>
			</thead>
			<tbody>
				<tr>
					<td colspan="7" class="text-right pull-right">
						<form name="thisForm" class="form-inline" role="form" ng-submit="commitAuditing(thisForm)">
							<div class="input-group ">
							  <span class="input-group-addon no-radius"> </span>
							  <input class="form-control w" type="text" ng-model="_self_module.module_name" readonly >
							  <span class="input-group-addon no-radius no-padding no-border"></span>
							  <select class="form-control w" ng-model="auditing_id">
								  <option value="{{auditing.auditing_id}}" ng-repeat="(i, auditing) in auditingList">{{auditing.auditing_name}}</option>
							  </select>
							  <span class="input-group-btn">
								  <div class="btn-group">
										<button type="submit" class="btn btn-rounded btn-info" btn-loading-text="{{'common.hint.LOADING' | translate}}"
											trigger-loading="beginLoading"><i class="glyphicon glyphicon-floppy-saved"> </i> 提交工作流</button>
								  </div>
							  </span>
							</div>
						</form>
					</td>
					<td class="text-right" ng-if="auditing.auditing_state==0">
						
						<div class="input-group col-sm-3">
							
						</div>
					</td>
				</tr>
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td colspan="3">
						
					</td>
					<td class="text-right">
						<div class="btn-group">
							<button type="button" class="btn btn-rounded btn-default btn-xs" ng-click="$hide()"><i class="fa fa-times-circle"> </i> 退回</button>
							<button type="submit" class="btn btn-rounded btn-info btn-xs" btn-loading-text="{{'common.hint.LOADING' | translate}}"
								trigger-loading="beginLoading"><i class="fa fa-check-circle"> </i> 通过</button>
						</div>
					</td>
				</tr>
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td colspan="3">
						
					</td>
					<td class="text-right">
						<div class="btn-group">
							<button type="button" class="btn btn-rounded btn-default btn-xs" ng-click="$hide()"><i class="fa fa-times"> </i> 退回</button>
							<button type="submit" class="btn btn-rounded btn-info btn-xs" btn-loading-text="{{'common.hint.LOADING' | translate}}"
								trigger-loading="beginLoading"><i class="ti-check"> </i> 通过</button>
						</div>
					</td>
				</tr>
				<tr>
					<th class="p-lg"></th>
					<th></th>
					<th></th>
					<th></th>
					<th></th>
					<th></th>
					<th></th>
				</tr>
				<tr>
					<td style="height:150px"></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
<script language="javascript">
app.controller('CategoryAuditingController', function($rootScope, $scope, $httpService, $location, $translate, $aside, 
	$ocLazyLoad, $alert, $stateParams, $routeParams) {
		$ocLazyLoad.load([__RESOURCE + "vendor/modules/angular-ui-select/select.min.js?" + __VERSION,
		__RESOURCE + "vendor/modules/angular-ui-select/select.min.css?" + __VERSION]);
		$rootScope._self_module = $scope.hashEmployeeModule[$stateParams.id];$scope.__IMGWEB = __IMGWEB;
		var urlParam = __WEB + 'app.do?channel=' + __AuditingViewUrl+"&c="+$stateParams.channel+'&id='+$rootScope.param.id;
	$scope.param = {}; $scope.edit_id = "";
	//定义变量
	console.log("CategoryAuditing routeParams",$rootScope.param);
	$scope.auditing = $rootScope.param.auditing;
	$scope.auditingList = [];$scope.auditing_id = 0;
	let aside;
	$httpService.header('method', 'getAuditing');
	$httpService.post(urlParam, $scope, function(result){
		$scope.loading.hide();
		$httpService.deleteHeader('method'); 
		if(result.data.success == false) {
			return;
		} 
		$scope.auditingList = result.data.item.auditingList;
	})
	
	$scope.commitAuditing = function(thisFrom) {
		$httpService.header('method', 'commitAuditing');
		$scope.param = {};$scope.param.auditing_id = this.auditing_id;
		$httpService.post(urlParam+'&status=1', $scope, function(result){//status=1 代表遞交審核
			$scope.loading.hide();
			$httpService.deleteHeader('method'); 
			if(result.data.success == false) {
				return;
			} 
			$scope.auditingList = result.data.item.auditingList;
		})
	}
	
});
</script>
